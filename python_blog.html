<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="stylesheets/blog1.css" media="screen" title="no title" charset="utf-8">
    <title>python_blog</title>
  </head>
  <body>
    <div class="block">
      <h1>python</h1>
    </div>
    <div class="block">
      <h1 id="toc_0">python学习笔记－socket编程（一）：服务器端</h1>

      <p>算是为了复习回顾暑假的学习的c语言下的socket编程，今天从9点开始用python写一个简单的使用服务器端和客户端传送文件，花了2个小时，最终成功从客户端传送图片到了服务器端，其中因为对于accept()函数的了解不够清晰，导致花了将近1个小时查文档。<br>
      服务器端的代码如下</p>

      <div><pre class="line-numbers"><code class="language-python">#!/usr/bin/python
      # -*- coding: UTF-8 -*-


      from socket import *

      size = 1024

      tcpsocket = socket(AF_INET,SOCK_STREAM)

      tcpsocket.bind((&#39;127.0.0.1&#39;,8006))

      print &#39;Sever Started&#39;

      tcpsocket.listen(5)

      tcpclient,addr= tcpsocket.accept()

      print &#39;Client acceptment successed&#39;

      f = open(&#39;xx&#39;,&#39;wb&#39;)
      while 1:
          x=tcpclient.recv(size)
          f.write(x)

      f.close()</code></pre></div>

      <p>这里对服务器端的每一行开始解释：</p>

      <div><pre class="line-numbers"><code class="language-python">#!/usr/bin/python
      # -*- coding: UTF-8 -*-</code></pre></div>

      <p>这里的两行的意思是，为了不让脚本显示使用python解释器，在unix系统中有个标准的实现方法；在脚本的首行前面加上#!（叫做pound bang或者shebang），在#!的后面加上用于解释脚本的程序的绝对路径（这里我写的服务端用的是python，所以这里的绝对路径就是python的）
      第二行的意思是指脚本的编码使用的是UTF-8</p>

      <div><pre class="line-numbers"><code class="language-python">from socket import *</code></pre></div>

      <p>这句话的意思是，将python自带的socket模块引入</p>

      <div><pre class="line-numbers"><code class="language-python">size = 1024

      tcpsocket = socket(AF_INET,SOCK_STREAM)

      tcpsocket.bind((&#39;127.0.0.1&#39;,8006))
      </code></pre></div>

      <p>这里的三行指的是，size是我自己定义的变量，用于下面的recv函数使用，接下去会提到recv函数
      第二行的socket(AF<em>INET,SOCK</em>STREAM)中间出现了两个较为古怪的量,分别是AF<em>INET,SOCK</em>STREAM,前者的意思是基于网络的地址家族（这里的内容太过底层，故这里建议仅仅只是记住，相信以后会有机会会接触这部分的细节，后者指的是使用tcp套接字，tcp套接字采用SOCK_STREAM，与之相对的是UDP套接字，UDP套接字因为其传输的不稳定而渐渐不被使用，这里采用的是常用的tcp套接字，第二行在大多数的socket服务端，使用socket函数创建套接字的时候都这么写。
      第三行，使用的是bind函数，这里的实际含义是：绑定地址（主机名，端口号）到套接字</p>

      <div><pre class="line-numbers"><code class="language-python">print &#39;Sever Started&#39;

      tcpsocket.listen(5)

      tcpclient,addr= tcpsocket.accept()

      print &#39;Client acceptment successed’
      </code></pre></div>

      <p>这里的第一行，只是为了检测服务器是否开启</p>

      <p>第二行的，listen函数实际含义是开始tcp监听，括号中的5，指的是开放5个接收端口，也就是最多允许5个客户端与其相连接。</p>

      <p>第三行，也是最关键的一行，之后那一个小时，我就全卡在这里。
      这里要注意的是，accept()函数返回的是类型不是单个变量，这里必须要两个变量来接受，如果单变量接受，python会自动默认是元组的类型，然后之后在recv函数的地方会出现AttributeError: &#39;tuple&#39; object has no attribute &#39;recv’这个错误，看来还是对accept函数认识不够深刻，以后应该专门看看accept函数源码去。这里的accept函数是用来连接客户端的函数，下一行的print &#39;Client acceptment successed’也是为了检验是否成功连接</p>

      <div><pre class="line-numbers"><code class="language-pyhton">f = open(&#39;xx&#39;,&#39;wb&#39;)
      while 1:
          x=tcpclient.recv(size)
          f.write(x)
      f.close()</code></pre></div>

      <p>这里的最后几行，实现一个功能，就是从客户端接受文件，并写入自己预先开好的空文件中间
      第一行，打开文件，并用“写入”模式，之后一个循环，中间有个函数recv函数，这里注意的是 ，这里用的不是服务器端的变量，而是client也就是客户端的变量，一开始我参看其他教程或者文献的时候百思不得其解，明明是服务器端接受文件，这里用的是client客户端的变量，最后我发现，client的变量实际上是从，tcpsocket.accept()过来的，也就是是说，这里的client变量只是，客户端在服务器端的一个映射，只是服务器端的一个接口，它的完全写法应该是，tcpsocket.accept().recv()，然后这里的size我在最初定义过，这里的意思就是指，它传送文件的大小，这里是1024字节，因为一次只传送1024字节肯定是不可能的，所以这里使用了一个循环，每次传送1024，再下面一行的f.write()函数是写入文件，最后在全部写完了之后，f.close()关闭文件。</p>

      <script type="text/javascript">
      var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(){var e=/\blang(?:uage)?-(?!\*)(\w+)\b/i,t=_self.Prism={util:{encode:function(e){return e instanceof n?new n(e.type,t.util.encode(e.content),e.alias):"Array"===t.util.type(e)?e.map(t.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},clone:function(e){var n=t.util.type(e);switch(n){case"Object":var a={};for(var r in e)e.hasOwnProperty(r)&&(a[r]=t.util.clone(e[r]));return a;case"Array":return e.map&&e.map(function(e){return t.util.clone(e)})}return e}},languages:{extend:function(e,n){var a=t.util.clone(t.languages[e]);for(var r in n)a[r]=n[r];return a},insertBefore:function(e,n,a,r){r=r||t.languages;var l=r[e];if(2==arguments.length){a=arguments[1];for(var i in a)a.hasOwnProperty(i)&&(l[i]=a[i]);return l}var o={};for(var s in l)if(l.hasOwnProperty(s)){if(s==n)for(var i in a)a.hasOwnProperty(i)&&(o[i]=a[i]);o[s]=l[s]}return t.languages.DFS(t.languages,function(t,n){n===r[e]&&t!=e&&(this[t]=o)}),r[e]=o},DFS:function(e,n,a,r){r=r||{};for(var l in e)e.hasOwnProperty(l)&&(n.call(e,l,e[l],a||l),"Object"!==t.util.type(e[l])||r[e[l]]?"Array"!==t.util.type(e[l])||r[e[l]]||(r[e[l]]=!0,t.languages.DFS(e[l],n,l,r)):(r[e[l]]=!0,t.languages.DFS(e[l],n,null,r)))}},plugins:{},highlightAll:function(e,n){for(var a,r=document.querySelectorAll('code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'),l=0;a=r[l++];)t.highlightElement(a,e===!0,n)},highlightElement:function(n,a,r){for(var l,i,o=n;o&&!e.test(o.className);)o=o.parentNode;o&&(l=(o.className.match(e)||[,""])[1],i=t.languages[l]),n.className=n.className.replace(e,"").replace(/\s+/g," ")+" language-"+l,o=n.parentNode,/pre/i.test(o.nodeName)&&(o.className=o.className.replace(e,"").replace(/\s+/g," ")+" language-"+l);var s=n.textContent,u={element:n,language:l,grammar:i,code:s};if(!s||!i)return t.hooks.run("complete",u),void 0;if(t.hooks.run("before-highlight",u),a&&_self.Worker){var g=new Worker(t.filename);g.onmessage=function(e){u.highlightedCode=e.data,t.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(u.element),t.hooks.run("after-highlight",u),t.hooks.run("complete",u)},g.postMessage(JSON.stringify({language:u.language,code:u.code,immediateClose:!0}))}else u.highlightedCode=t.highlight(u.code,u.grammar,u.language),t.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(n),t.hooks.run("after-highlight",u),t.hooks.run("complete",u)},highlight:function(e,a,r){var l=t.tokenize(e,a);return n.stringify(t.util.encode(l),r)},tokenize:function(e,n){var a=t.Token,r=[e],l=n.rest;if(l){for(var i in l)n[i]=l[i];delete n.rest}e:for(var i in n)if(n.hasOwnProperty(i)&&n[i]){var o=n[i];o="Array"===t.util.type(o)?o:[o];for(var s=0;s<o.length;++s){var u=o[s],g=u.inside,c=!!u.lookbehind,f=0,h=u.alias;u=u.pattern||u;for(var p=0;p<r.length;p++){var d=r[p];if(r.length>e.length)break e;if(!(d instanceof a)){u.lastIndex=0;var m=u.exec(d);if(m){c&&(f=m[1].length);var y=m.index-1+f,m=m[0].slice(f),v=m.length,k=y+v,b=d.slice(0,y+1),w=d.slice(k+1),P=[p,1];b&&P.push(b);var A=new a(i,g?t.tokenize(m,g):m,h);P.push(A),w&&P.push(w),Array.prototype.splice.apply(r,P)}}}}}return r},hooks:{all:{},add:function(e,n){var a=t.hooks.all;a[e]=a[e]||[],a[e].push(n)},run:function(e,n){var a=t.hooks.all[e];if(a&&a.length)for(var r,l=0;r=a[l++];)r(n)}}},n=t.Token=function(e,t,n){this.type=e,this.content=t,this.alias=n};if(n.stringify=function(e,a,r){if("string"==typeof e)return e;if("Array"===t.util.type(e))return e.map(function(t){return n.stringify(t,a,e)}).join("");var l={type:e.type,content:n.stringify(e.content,a,r),tag:"span",classes:["token",e.type],attributes:{},language:a,parent:r};if("comment"==l.type&&(l.attributes.spellcheck="true"),e.alias){var i="Array"===t.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(l.classes,i)}t.hooks.run("wrap",l);var o="";for(var s in l.attributes)o+=(o?" ":"")+s+'="'+(l.attributes[s]||"")+'"';return"<"+l.tag+' class="'+l.classes.join(" ")+'" '+o+">"+l.content+"</"+l.tag+">"},!_self.document)return _self.addEventListener?(_self.addEventListener("message",function(e){var n=JSON.parse(e.data),a=n.language,r=n.code,l=n.immediateClose;_self.postMessage(t.highlight(r,t.languages[a],a)),l&&_self.close()},!1),_self.Prism):_self.Prism;var a=document.getElementsByTagName("script");return a=a[a.length-1],a&&(t.filename=a.src,document.addEventListener&&!a.hasAttribute("data-manual")&&document.addEventListener("DOMContentLoaded",t.highlightAll)),_self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism);
      </script>
      <script type="text/javascript">
      Prism.languages.python={"triple-quoted-string":{pattern:/"""[\s\S]+?"""|'''[\s\S]+?'''/,alias:"string"},comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0},string:/("|')(?:\\?.)*?\1/,"function":{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_][a-zA-Z0-9_]*(?=\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)[a-z0-9_]+/i,lookbehind:!0},keyword:/\b(?:as|assert|async|await|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|pass|print|raise|return|try|while|with|yield)\b/,"boolean":/\b(?:True|False)\b/,number:/\b-?(?:0[bo])?(?:(?:\d|0x[\da-f])[\da-f]*\.?\d*|\.\d+)(?:e[+-]?\d+)?j?\b/i,operator:/[-+%=]=?|!=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]|\b(?:or|and|not)\b/,punctuation:/[{}[\];(),.:]/};
      </script>
      <script type="text/javascript">
      !function(){"undefined"!=typeof self&&self.Prism&&self.document&&Prism.hooks.add("complete",function(e){if(e.code){var t=e.element.parentNode,s=/\s*\bline-numbers\b\s*/;if(t&&/pre/i.test(t.nodeName)&&(s.test(t.className)||s.test(e.element.className))&&!e.element.querySelector(".line-numbers-rows")){s.test(e.element.className)&&(e.element.className=e.element.className.replace(s,"")),s.test(t.className)||(t.className+=" line-numbers");var n,a=e.code.match(/\n(?!$)/g),l=a?a.length+1:1,m=new Array(l+1);m=m.join("<span></span>"),n=document.createElement("span"),n.className="line-numbers-rows",n.innerHTML=m,t.hasAttribute("data-start")&&(t.style.counterReset="linenumber "+(parseInt(t.getAttribute("data-start"),10)-1)),e.element.appendChild(n)}}})}();
      </script>
      <script type="text/javascript">
      !function(){if("undefined"!=typeof self&&self.Prism&&self.document){var e={css:"CSS",clike:"C-like",javascript:"JavaScript",abap:"ABAP",actionscript:"ActionScript",apacheconf:"Apache Configuration",apl:"APL",applescript:"AppleScript",asciidoc:"AsciiDoc",aspnet:"ASP.NET (C#)",autoit:"AutoIt",autohotkey:"AutoHotkey",basic:"BASIC",csharp:"C#",cpp:"C++",coffeescript:"CoffeeScript","css-extras":"CSS Extras",fsharp:"F#",glsl:"GLSL",http:"HTTP",inform7:"Inform 7",json:"JSON",latex:"LaTeX",lolcode:"LOLCODE",matlab:"MATLAB",mel:"MEL",nasm:"NASM",nginx:"nginx",nsis:"NSIS",objectivec:"Objective-C",ocaml:"OCaml",parigp:"PARI/GP",php:"PHP","php-extras":"PHP Extras",powershell:"PowerShell",jsx:"React JSX",rest:"reST (reStructuredText)",sas:"SAS",sass:"Sass (Sass)",scss:"Sass (Scss)",sql:"SQL",typescript:"TypeScript",vhdl:"VHDL",vim:"vim",wiki:"Wiki markup",yaml:"YAML"};Prism.hooks.add("before-highlight",function(s){var a=s.element.parentNode;if(a&&/pre/i.test(a.nodeName)){var t,i,r=a.getAttribute("data-language")||e[s.language]||s.language.substring(0,1).toUpperCase()+s.language.substring(1),l=a.previousSibling;l&&/\s*\bprism-show-language\b\s*/.test(l.className)&&l.firstChild&&/\s*\bprism-show-language-label\b\s*/.test(l.firstChild.className)?i=l.firstChild:(t=document.createElement("div"),i=document.createElement("div"),i.className="prism-show-language-label",t.className="prism-show-language",t.appendChild(i),a.parentNode.insertBefore(t,a)),i.innerHTML=r}})}}();
      </script>
      <script type="text/x-mathjax-config">
      if (typeof MathJaxListener !== 'undefined') {
        MathJax.Hub.Register.StartupHook('End', function () {
          MathJaxListener.invokeCallbackForKey_('End');
        });
      }
      </script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    </div>
  </body>
</html>
